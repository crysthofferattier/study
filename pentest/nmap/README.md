# NMAP
* [The Complete Nmap Ethical Hacking Course: Network Security](https://www.udemy.com/the-complete-nmap-ethical-hacking-course-network-security/)

## 04. Nmap Basics Target Specification & Port States

* Nmap help
```
$ nmap -h
```

### Nmap Basics

* Basic command
```
$ nmap 192.168.0.106
```

* Output
```
Starting Nmap 7.01 ( https://nmap.org ) at 2018-02-05 20:17 -03
Nmap scan report for 192.168.0.106
Host is up (0.000071s latency).
Not shown: 977 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
23/tcp   open  telnet
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
512/tcp  open  exec
513/tcp  open  login
514/tcp  open  shell
1099/tcp open  rmiregistry
1524/tcp open  ingreslock
2049/tcp open  nfs
2121/tcp open  ccproxy-ftp
3306/tcp open  mysql
5432/tcp open  postgresql
5900/tcp open  vnc
6000/tcp open  X11
6667/tcp open  irc
8009/tcp open  ajp13
8180/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 0.09 seconds
```

* Top Port's
```
$ sort -r -k3 /usr/share/nmap/nmap-services | grep tcp | head -n 1000
```

* Run
	- Privilaged (root/admin) = Raw SYN Stealth Scan
	- Unprivilaged = TCP Connect Scan

### Nmap Target Specification

* Can pass hostnames, IP addresses, networks, etc.
```
$ nmap scanme.nmap.org
$ nmap microsoft.com/24 
$ nmap 192.168.0.1
$ nmap 10.0.0-255.1-254
```

* -iL [inputfilename]: Input from list of hosts/networks
```
$ nmap -iL targets.txt
```

* -iR [num hosts]: Choose random targets
```
$ nmap -iR 3 -v
```


### Nmap Port states

* Open: An application is actively accepting TCP connections, UDP datagrams or SCTP associations on this port.
* Closed: A closed port is accessible (it receives and responds to Nmap probe packets), but there is no application listening on it.
* Filtered: Nmap cannot determine whether the port is open because packet filtering prevents its probes from reaching the port.
* Unfiltered: The unfiltered state means that a port is accessible, but Nmap is unable to determine whether it is open or closed.
* Open|Filtered: Nmap places ports in this state when it is unable to determine whether a port is open or filtered.
* Closed|Filtered: This state is used when Nmap is unable to determine whether a port is closed or filtered.

## 05. Nmap Discovery and Ping Scanning

### Nmap Discovery (Part 1)

```
$ nmap 192.168.0.100-106
```

* If no host discovery options, nmap send an:
	- ICMP echo request (ping)
	- TCP SYN packet to port 443
	- TCP ACK packet to port 80
	- ICMP timestamp request

* Exceptions:
	- ARP (for IPv4) and Neighbor Discovery (for IPv6) scans which are used for any targets on a local ethernet network.

### Nmap Discovery (Part 2)

* -sL: list scan, simply list targets to scan.
```
$ nmap facebook.com/24 -sL
$ nmap -iR 300 -sL -vv
```

* -sn: Ping Scan, disable port scan.
```
$ nmap 192.168.0.1/24 -sn
```

* -Pn: Treat all hosts as online, skip host discovery.
```
$ nmap 192.168.0.1/24 -Pn
```

### Nmap Discovery (Part 3)

* -PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
```
$ nmap 192.168.0.1-5 -PS22-25,80,113,1050,3500 -v
```

### Nmap Discovery (Part 4)
* -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
```
$ nmap 192.168.1.1-255 -PE -sn -v
```

* -PO[protocol list]: IP Protocol Ping
```
$ nmap 192.168.1.1-255 -PO1,2,4 -sn
```

* -PR: ARP scan (local network)
```
$ nmap 192.168.1.1-255 -PR -sn -vv
```

* --dns-servers: Specify custom DNS servers
```
$ nmap 192.168.1.1-50 -sL --dns-servers 192.168.1.1
```

* --traceroute: Trace hop path to each host
```
$ nmap -iR 3 -sn --traceroute
```

## 06. Nmap Scan Techniques